<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
<link rel="canonical" href="http://ddongeee.github.io/categories/redis/">
<meta name="naver-site-verification" content="92fcd64c1794d133f4339ce4c26faa8ba3eb36b9">

<meta name="generator" content="Hexo 4.2.1">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<title>Category: redis - Crayon&#39;s Blog</title>


    <meta property="og:type" content="website">
<meta property="og:title" content="Crayon&#39;s Blog">
<meta property="og:url" content="http://ddongeee.github.io/categories/redis/index.html">
<meta property="og:site_name" content="Crayon&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://ddongeee.github.io/images/og_image.png">
<meta property="article:author" content="Crayon">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ddongeee.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55065107-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-55065107-2');
</script>

    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/rss2.xml" title="Crayon's Blog" type="application/rss+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Crayon&#39;s Blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus" rel="external nofollow noopener noreferrer">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <!--<div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">Categories</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">redis</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2018/11/12/about-redis/" class="image is-7by1">
            <img class="thumbnail" src="/images/redis.png" alt="About Redis">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-11-12T02:50:00.000Z">2018-11-12</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/redis/">redis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    22 minutes read (About 3253 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/11/12/about-redis/">About Redis</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="REDIS-개요"><a href="#REDIS-개요" class="headerlink" title="REDIS 개요"></a>REDIS 개요</h2><h3 id="REDIS란"><a href="#REDIS란" class="headerlink" title="REDIS란?"></a>REDIS란?</h3><p>REmote DIctionary Server, 디스크 기반이 아닌 인메모리 기반 데이터 저장소이다. 메모리를 사용하기 때문에 매우 빠른 장점이 있으며, 고가용성 및 샤딩을 통한 파티셔닝을 지원한다. 하지만 단점으로는 메모리 크기에 한정적이다. 아직까지는 동일 용량의 디스크 대비 메모리 가격이 비싸다. 그래서 사용하는 메모리 용량에 따라 경제적 부담을 져야하는 기회비용에 직면하게 된다. 또한 레디스는 키벨류 베이스의 디비로써, 복잡한 연산의 데이터베이스 방식에는 적절하지 않으나?! 아래 소개하는 spring data redis 로 구현은?! 할수 있다. 하지만, 여기에도 장단이 존재한다.. 관련해서 아래에서 알아보자. </p>
<p>리스트 데이터 입력 삭제가 MYSQL 대비 10배 빠르다고함! MAX <strong>100,000 QPS</strong></p>
<p>Redis서버는 1개의 싱글 쓰레드로 수행, 따라서 하나의 서버에 여러개의 서버 띄우는게 가능, 또한 이러한 특성으로 다양한 이슈가 만들어 질수 있음</p>
<h3 id="REDIS-vs-MEMCACHED"><a href="#REDIS-vs-MEMCACHED" class="headerlink" title="REDIS vs MEMCACHED"></a>REDIS vs MEMCACHED</h3><ul>
<li><p>둘다 속도는 100000QPS 로 비슷</p>
</li>
<li><p>둘다 샤딩을 통한 클러스터링 모드 지원</p>
</li>
<li><p>자료구조는 레디스가 많이 지원, 멤케시는 key-value만 지원</p>
</li>
<li><p>안정성의경우, 멤케시는 장애가 거의 없으나, 레디스의 경우 특성을 잘못 이해할경우 프로세스 장애 발생. flush_all 같은경우</p>
</li>
<li><p>응답속도의 균일성의 경우, 멤케시는 전체적으로 균일하나, 레디스는 멤케시에 비해 균일성이 떨어 질수 있음, 롱쿼리..</p>
</li>
<li><p>장애대응 혹은 영속성의경우, 레디스는 RDB(Snapshot)와 AOF(Journal)지원, 하지만 맴케시는 프로세스 재시작시 데이터 모두 날라감. 멤캐시 철학은 약간 “캐시는 정말 캐시 용도로만 써야되고, 데이터 초기화시 다시 원천소스를 조회하여 캐싱해야한다.” 와 같음</p>
</li>
<li><p>멤케시의 경우 ‘라이브러리로’ master/master 리플리케이션만 지원, 하지만 레디스는 ‘자체기능’으로 (master/slave)리플리케이션만 지원</p>
</li>
</ul>
<h3 id="REDIS-DATA-TYPE"><a href="#REDIS-DATA-TYPE" class="headerlink" title="REDIS DATA TYPE"></a>REDIS DATA TYPE</h3><p>아래에서 설명하는 데이터타입의경우, 실제 key-value 에서 value에 저장되는 데이터 타입을 말한다. 이것을 반드시 인지하고있어야한다.</p>
<ul>
<li>String<ul>
<li>동작 및 특징<ul>
<li>가장 기본이 되는 타입</li>
</ul>
</li>
<li>용도<ul>
<li>HTML 페이지, API 응답 이미지, 비디오, 텍스트, 바이너리 데이터 등 캐시</li>
<li>개수 계산이 필요한 페이지뷰, 비디오뷰 좋아요 같은 서비스</li>
</ul>
</li>
</ul>
</li>
<li>Hash<ul>
<li>동작 및 특징<ul>
<li>키값에 해당되는 필드를 선택적으로 가져올수 잇다. </li>
<li>객체를 저장하는데 훌륭</li>
</ul>
</li>
<li>용도<ul>
<li>특정 Key 값에 여러 field(hashKey)가 존재하여, 다양한 케이스에서 선택적으로 value를 가져와야하는경우</li>
</ul>
</li>
</ul>
</li>
<li>List<ul>
<li>동작 및 특징<ul>
<li>collection, stack, queue와 같이 동작 할수 있음</li>
</ul>
</li>
<li>용도<ul>
<li>이벤트큐, 최근 사용자 글 저장하기등</li>
</ul>
</li>
</ul>
</li>
<li>Set <ul>
<li>동작 및 특징<ul>
<li>순서없고, 동일한 값이 없는 콜렉션 특성을 가지고 있다. (추가,삭제,검색 성능 속도 O(1))</li>
<li>내부는 hash table 로 구현되있다.</li>
<li>교집합, 합집합 빠르게 계산</li>
</ul>
</li>
<li>용도<ul>
<li>데이터 필터링 : 특정도시에서 출발해서 특정도시로 도착하는 모든 비행기 필터링?</li>
<li>데이터 그룹핑 : 비슷한 제품을 보는 모든 사용자 그룹핑</li>
<li>엘리먼트십 확인 : 블랙리스트확인 혹은 사용자가 이미 푸시를 받앗는지 확인하기(dup check)</li>
</ul>
</li>
</ul>
</li>
<li>Sorted Set<ul>
<li>동작 및 특징</li>
<li>용도</li>
</ul>
</li>
<li><strong>BitMap</strong><ul>
<li>동작 및 특징<ul>
<li>특정 인덱스에 값을 0 또는 1로 set 및 get이 가능하다.</li>
<li>단일 저장 용량이 1Bit 라서, 메모리를 아주 적게 사용하여 스냅샷 서비스를 제공할수 있다.</li>
</ul>
</li>
<li>용도<ul>
<li>오늘 방문한 순수 사용자, 혹은 카운트</li>
<li>특정 모바일 아이디에 중복 발송을 필터링하기위한 테이블</li>
</ul>
</li>
</ul>
</li>
<li>HyperLogLog<ul>
<li>동작 및 특징</li>
<li>용도</li>
</ul>
</li>
</ul>
<h3 id="REDIS-PERSISTENCE"><a href="#REDIS-PERSISTENCE" class="headerlink" title="REDIS PERSISTENCE"></a>REDIS PERSISTENCE</h3><ul>
<li><p>시스템의 영속성을 보장하기위해 레디스에선 데이터를 디스크에 백업해 놓는 2가지 방식을 제공하고 있다.</p>
<ul>
<li><strong>Snapshotting</strong> : 레디스에 저장된 데이터를 바이너리 스냅샷으로 생성(메모리 덤프) > RDB 모드<ul>
<li>fork 로 자식 프로세스 생성하여 저장하는 방식<ul>
<li><strong>쓰기 작업이 많아지면 부모와 자식 둘다 같은 크기의 메모리를 사용할수 있음. 메모리 부족 이슈 가능</strong></li>
</ul>
</li>
<li>설정파일에 save 900 1 , save 300 60, save 60 10000 과 같이 설정</li>
</ul>
</li>
<li><strong>Journaling</strong> : 시간이 지나면서 요청된 커맨드를 사람이 읽을수 있는 파일로 생성 > AOF 모드</li>
</ul>
</li>
<li><p>만약 재기동 시점에 둘다 있으면, AOF 가 가장 마지막까지 실행됫다고 가정하고, AOF 모드로 재실행</p>
</li>
<li><p>하지만 이러한 persistence 기능이 장애의 주된 원인이 될수있어서, 아주 잘 사용해야 한다.</p>
</li>
</ul>
<h3 id="KEY-EXPIREATION-TRANSACTION-PUB-SUB"><a href="#KEY-EXPIREATION-TRANSACTION-PUB-SUB" class="headerlink" title="KEY EXPIREATION, TRANSACTION, PUB/SUB"></a>KEY EXPIREATION, TRANSACTION, PUB/SUB</h3><h4 id="KEY-EXPIREATION"><a href="#KEY-EXPIREATION" class="headerlink" title="KEY EXPIREATION"></a>KEY EXPIREATION</h4><p>key 값에 expireTime 지정이 가능하며, 해당 만료 시간을 기준으로 데이터가 삭제된다. 2가지 방식이 있으며, 초단위로 설정하거나 종료시점 날짜를 설정하여 만료시킬수 있음</p>
<p>맴케시의경우, 사용자가 get할때 expire체크를 하여 만료작업을 처리하지만, 레디스는 이 방법과 더불어 내부적으로 cron()을 돌려 추가적으로 만료작업을 진행한다.</p>
<h4 id="TRANSACTION"><a href="#TRANSACTION" class="headerlink" title="TRANSACTION"></a>TRANSACTION</h4><h4 id="PUB-SUB"><a href="#PUB-SUB" class="headerlink" title="PUB/SUB"></a>PUB/SUB</h4><h3 id="REDIS-CLUSTER"><a href="#REDIS-CLUSTER" class="headerlink" title="REDIS CLUSTER"></a>REDIS CLUSTER</h3><p>레디스 시스템 성능 확장을 위해 클러스터 모드로 레디스를 실행할수 있다. </p>
<p>노드간에 처리 대상은 수평분할(샤딩)의 한 방식인 해시분할(Hash partitioning)에 의해서 결정된다</p>
<p>해시분할방식은, 해시함수에 키값을 넣어 정수값(0~16383)을 추출, 각 마스터 노드 해시슬롯 범위에 포함된 곳에서 처리되도록 한다.</p>
<p>이러한 Hash key slot을 사용하여 샤딩방식으로 트래픽을 클러스터 노드별로 분산한다.</p>
<h3 id="REDIS-REPLICATION"><a href="#REDIS-REPLICATION" class="headerlink" title="REDIS REPLICATION"></a>REDIS REPLICATION</h3><ul>
<li>혹시모를 장애로 마스터 서버 이슈로, 데이터 유실 혹은 read 트래픽 분산을 위해 레디스 또한 데이터 리플리케이션 기능을 제공한다.</li>
<li>master / slave 복제 방식이다</li>
</ul>
<h3 id="REDIS-HA-High-Avaliability"><a href="#REDIS-HA-High-Avaliability" class="headerlink" title="REDIS HA(High Avaliability)"></a>REDIS HA(High Avaliability)</h3><ul>
<li>기본적으론 레디스 센티널 HA 컨트롤 되긴함.</li>
<li>m/s 복제 되어잇어야함</li>
<li>redis2.6부터 slave-read-only가 yes로 되어 있어, 무조건 마스터승격 시에 쓰기 요청 모두 실패됨. 추가설정필요..</li>
<li>하지만, 아주 다행히 AWS Elastic cache:Redis 사용시 replication, multi-az 2개 설정만으로 자동 장애복구 지원됨.<ul>
<li>replica 만 선택하고, multi-az 설정안하면, 사용자가 직접 마스터 승격시켜줘야하니.. multi-az 설정까지 해주자.ㅎㅎ</li>
<li>참고 : <a href="https://aws.amazon.com/ko/elasticache/faqs#다중_AZ" target="_blank" rel="external nofollow noopener noreferrer">https://aws.amazon.com/ko/elasticache/faqs#다중_AZ</a></li>
</ul>
</li>
</ul>
<h2 id="REDIS-적용"><a href="#REDIS-적용" class="headerlink" title="REDIS 적용"></a>REDIS 적용</h2><h3 id="‘’터미널’’에서-REDIS-클러스터-로컬환경-구축-및-사용"><a href="#‘’터미널’’에서-REDIS-클러스터-로컬환경-구축-및-사용" class="headerlink" title="‘’터미널’’에서 REDIS (클러스터) 로컬환경 구축 및 사용"></a>‘’터미널’’에서 REDIS (클러스터) 로컬환경 구축 및 사용</h3><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># redis가 로컬에 설치 되엇다는 가정하에 아래 실습을 진행할수 있다. </span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 6379 포트로 redis를 띄운다.</span></span><br><span class="line">$ redis-server</span><br><span class="line">127.0.0.1:6379> {{redis <span class="hljs-built_in">command</span>}}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis-cli는 레디스에 커맨드를 실행할수 있게 해준다. </span></span><br><span class="line"><span class="hljs-comment"># 아래는 해당 노드에 저장된 값의 size를 알수있는 command</span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">### 실제 로컬에서 띄울때 클러스터 모드로 띄워도 될듯!! 아래는 그 방법###</span></span><br><span class="line"></span><br><span class="line">$ redis-server --port 5000 --cluster-enabled yes --cluster-config-file nodes-5000.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5000.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-server --port 5001 --cluster-enabled yes --cluster-config-file nodes-5001.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5001.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-server --port 5002 --cluster-enabled yes --cluster-config-file nodes-5002.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5002.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster addslots {0..5460}</span><br><span class="line">$ redis-cli -c -p 5001 cluster addslots {5461..10922}</span><br><span class="line">$ redis-cli -c -p 5002 cluster addslots {10923..16383}</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster <span class="hljs-built_in">set</span>-config-epoch 1</span><br><span class="line">$ redis-cli -c -p 5001 cluster <span class="hljs-built_in">set</span>-config-epoch 2</span><br><span class="line">$ redis-cli -c -p 5002 cluster <span class="hljs-built_in">set</span>-config-epoch 3</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster meet 127.0.0.1 5001</span><br><span class="line">$ redis-cli -c -p 5000 cluster meet 127.0.0.1 5002</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 6000 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6001 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6002 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6003 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6004 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6005 cluster meet 127.0.0.1 5000</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 6000 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6001 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6002 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6003 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6004 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6005 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 클러스터 모드에서 사용</span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000 -c</span><br><span class="line">127.0.0.1:5000> <span class="hljs-built_in">set</span> hello world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:5000> get hello</span><br><span class="line"><span class="hljs-string">"world"</span></span><br><span class="line">127.0.0.1:5000> <span class="hljs-built_in">set</span> hello2 world2</span><br><span class="line">-> Redirected to slot [7486] located at 127.0.0.1:5001</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:5001> get hello2</span><br><span class="line"><span class="hljs-string">"world2"</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="REDIS-Client-Library-각-라이브러리-장단점"><a href="#REDIS-Client-Library-각-라이브러리-장단점" class="headerlink" title="REDIS Client Library(각 라이브러리 장단점)"></a>REDIS Client Library(각 라이브러리 장단점)</h3><p>java base의 redis client libracy 중에 recommed 하는 라이브러리는 크게 3가지 Jedis, Lettuce, Redisson가 있다.</p>
<h4 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h4><ul>
<li>small</li>
</ul>
<h4 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h4><ul>
<li>thread-safe sync</li>
<li>async</li>
</ul>
<h4 id="REDISON"><a href="#REDISON" class="headerlink" title="REDISON"></a>REDISON</h4><ul>
<li>비동기 하이퍼포먼스</li>
<li>lock free redis client</li>
</ul>
<h3 id="AWS-REDIS-소개"><a href="#AWS-REDIS-소개" class="headerlink" title="AWS REDIS 소개"></a>AWS REDIS 소개</h3><p>AWS 의 서비스중에 <strong>ElasticCache</strong> 라는 것이 있는데, 해당 서비스는 인메모리 서비스 그룹으로, 실제로 해당 서비스 실행을 위해 Redis를 쓸지 Memchaed를 쓸지 선택할수 있다. AWS의 인프라 제공 능력?!으로 클릭 몇번으로 클러스터기반 마스터슬래이브 레디스 서비스를 실행할수 있다. (자동 장애복구 기능도 지원한당. 짜응)</p>
<h2 id="기타-알면-좋은것들"><a href="#기타-알면-좋은것들" class="headerlink" title="기타 알면 좋은것들"></a>기타 알면 좋은것들</h2><h3 id="SPRINT-DATA-REDIS-Spring-data-redis-lettuce"><a href="#SPRINT-DATA-REDIS-Spring-data-redis-lettuce" class="headerlink" title="SPRINT DATA REDIS (Spring data redis + lettuce)"></a>SPRINT DATA REDIS (Spring data redis + lettuce)</h3><h4 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h4><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// entity class</span></span><br><span class="line"><span class="hljs-meta">@Getter</span></span><br><span class="line"><span class="hljs-meta">@Builder</span></span><br><span class="line"><span class="hljs-meta">@AllArgsConstructor</span>(access = AccessLevel.PRIVATE)</span><br><span class="line"><span class="hljs-meta">@NoArgsConstructor</span></span><br><span class="line"><span class="hljs-meta">@ToString</span></span><br><span class="line"><span class="hljs-meta">@RedisHash</span>(<span class="hljs-string">"pushResult"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushResult</span> </span>{</span><br><span class="line">	<span class="hljs-meta">@Id</span></span><br><span class="line">	<span class="hljs-keyword">private</span> Long id;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> mobileSeq;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> campaignId;</span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> offerId;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> LocalDateTime preferredAt;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// *RedisRepository interface</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PushResultRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span><<span class="hljs-title">PushResult</span>, <span class="hljs-title">Long</span>> </span>{</span><br><span class="line">	<span class="hljs-function">PushResult <span class="hljs-title">findByMobileSeqAndCampaignId</span><span class="hljs-params">(Long mobileSeq, Long cId)</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// service class</span></span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> PushResultService {</span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> PushResultRepository pushResultRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(PushResult pushResult)</span> </span>{</span><br><span class="line">        pushResultRepository.save(pushResult);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> PushResult <span class="hljs-title">getByMobileSeqAndCId</span><span class="hljs-params">(Long mobileSeq, Long cId)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">return</span> pushResultRepository.findByMobileSeqAndCampaignId(mobileSeq, cId);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="동작"><a href="#동작" class="headerlink" title="동작"></a>동작</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">###############################################################</span></span><br><span class="line"><span class="hljs-comment"># 위 spring data jpa 를 사용하여 1건의 pushResult 를 save 할경우 #</span></span><br><span class="line"><span class="hljs-comment">###############################################################</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis cluster nodes 에 저장된 key 개수 </span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5001 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5002 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis cluster nodes 에 저장된 key 종류</span></span><br><span class="line">$ 127.0.0.1:5000> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:campaignId:223456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:-7496779863478802681:idx"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5001> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:preferredAt:2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$127</span>.0.0.1:5002> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:mobileSeq:123456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:-7496779863478802681"</span></span><br><span class="line">3) <span class="hljs-string">"pushResult"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 각 key 에 대한 value</span></span><br><span class="line">$ 127.0.0.1:5000> smembers pushResult:campaignId:223456</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5000> smembers pushResult:-7496779863478802681:idx</span><br><span class="line">1) <span class="hljs-string">"pushResult:mobileSeq:123456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:campaignId:223456"</span></span><br><span class="line">3) <span class="hljs-string">"pushResult:preferredAt:2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5001> smembers pushResult:preferredAt:2018-10-16T15:49:12.949</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5002> smembers pushResult:mobileSeq:123456</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5002> smembers pushResult</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5002> hkeys pushResult:-7496779863478802681</span><br><span class="line">1) <span class="hljs-string">"_class"</span></span><br><span class="line">2) <span class="hljs-string">"mobileSeq"</span></span><br><span class="line">3) <span class="hljs-string">"id"</span></span><br><span class="line">4) <span class="hljs-string">"mobileSeq._class"</span></span><br><span class="line">5) <span class="hljs-string">"offerId"</span></span><br><span class="line">6) <span class="hljs-string">"offerId._class"</span></span><br><span class="line">7) <span class="hljs-string">"campaignId"</span></span><br><span class="line">8) <span class="hljs-string">"campaignId._class"</span></span><br><span class="line">9) <span class="hljs-string">"preferredAt"</span></span><br><span class="line">$ 127.0.0.1:5002> hgetall pushResult:-7496779863478802681</span><br><span class="line"> 1) <span class="hljs-string">"mobileSeq._class"</span></span><br><span class="line"> 2) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line"> 3) <span class="hljs-string">"offerId"</span></span><br><span class="line"> 4) <span class="hljs-string">"123456"</span></span><br><span class="line"> 5) <span class="hljs-string">"offerId._class"</span></span><br><span class="line"> 6) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line"> 7) <span class="hljs-string">"campaignId"</span></span><br><span class="line"> 8) <span class="hljs-string">"223456"</span></span><br><span class="line"> 9) <span class="hljs-string">"campaignId._class"</span></span><br><span class="line">10) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line">11) <span class="hljs-string">"mobileSeq"</span></span><br><span class="line">12) <span class="hljs-string">"123456"</span></span><br><span class="line">13) <span class="hljs-string">"_class"</span></span><br><span class="line">14) <span class="hljs-string">"com.~.pushcontroller.domain.result.PushResult"</span></span><br><span class="line">15) <span class="hljs-string">"id"</span></span><br><span class="line">16) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">17) <span class="hljs-string">"preferredAt"</span></span><br><span class="line">18) <span class="hljs-string">"2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">############################## 위 명령어가 다른이유 ##############################</span></span><br><span class="line"><span class="hljs-comment"># if value is of type string -> GET <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type hash -> HGETALL <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type lists -> lrange <key> <start> <end></end></start></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type sets -> smembers <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type sorted sets -> ZRANGEBYSCORE <key> <min> <max></max></min></key></span></span><br><span class="line"><span class="hljs-comment">#############################################################################</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="REDIS-비교-결과"><a href="#REDIS-비교-결과" class="headerlink" title="REDIS 비교 결과"></a>REDIS 비교 결과</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">##############################</span></span><br><span class="line"><span class="hljs-comment"># [Local 환경]퍼포먼스 테스트 결과 #</span></span><br><span class="line"><span class="hljs-comment">##############################</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># master 3, slave6, network high</span></span><br><span class="line"><span class="hljs-comment"># Redisson (pure redis client): 10000/sec</span></span><br><span class="line"><span class="hljs-comment"># spring data redis : 33.3/sec</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h3><h4 id="CLUSTER-INFO"><a href="#CLUSTER-INFO" class="headerlink" title="CLUSTER INFO"></a>CLUSTER INFO</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># cluster meet 전</span></span><br><span class="line">cluster_state:fail</span><br><span class="line">cluster_slots_assigned:0</span><br><span class="line">cluster_slots_ok:0</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:1</span><br><span class="line">cluster_size:0</span><br><span class="line">cluster_current_epoch:0</span><br><span class="line">cluster_my_epoch:0</span><br><span class="line">cluster_stats_messages_sent:0</span><br><span class="line">cluster_stats_messages_received:0</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># cluster meet 후</span></span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:3</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:3</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:553</span><br><span class="line">cluster_stats_messages_pong_sent:553</span><br><span class="line">cluster_stats_messages_meet_sent:2</span><br><span class="line">cluster_stats_messages_sent:1108</span><br><span class="line">cluster_stats_messages_ping_received:553</span><br><span class="line">cluster_stats_messages_pong_received:555</span><br><span class="line">cluster_stats_messages_received:1108</span><br></pre></td></tr></tbody></table></figure>



<h4 id="CLUSTER-KEYSLOT"><a href="#CLUSTER-KEYSLOT" class="headerlink" title="CLUSTER KEYSLOT "></a>CLUSTER KEYSLOT </h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ 127.0.0.1:5000> cluster keyslot pushResult:campaignId:225763</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 11216</span><br></pre></td></tr></tbody></table></figure>



<h4 id="CLIENT-LIST"><a href="#CLIENT-LIST" class="headerlink" title="CLIENT LIST"></a>CLIENT LIST</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ 127.0.0.1:5000> client list</span><br><span class="line">id=320 addr=127.0.0.1:49228 fd=320 name= age=1890 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=client</span><br><span class="line">id=16 addr=127.0.0.1:63855 fd=16 name= age=2452 idle=2416 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=cluster</span><br></pre></td></tr></tbody></table></figure>



<h3 id="redis-trib-rb-사용하기"><a href="#redis-trib-rb-사용하기" class="headerlink" title="# redis-trib.rb 사용하기"></a># redis-trib.rb 사용하기</h3><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># redis cluster info</span></span><br><span class="line"><<<<<<< HEAD:_drafts/about-redis.md</span><br><span class="line"><span class="hljs-comment"># /Development/study/redis/redis-stable/src/redis-trib.rb </span></span><br><span class="line">=======</span><br><span class="line">>>>>>>> 8199a64e366805ddde1586b4cf8444993e165799:_posts/2018-11-11-about-redis.md</span><br><span class="line">$./redis-trib.rb info 127.0.0.1:5000</span><br><span class="line">127.0.0.1:5000 (8b4b5f3a...) -> 2 keys | 5461 slots | 0 slaves.</span><br><span class="line">127.0.0.1:5001 (9865af8c...) -> 0 keys | 5462 slots | 0 slaves.</span><br><span class="line">127.0.0.1:5002 (21ca40a9...) -> 4 keys | 5461 slots | 0 slaves.</span><br><span class="line">[OK] 6 keys <span class="hljs-keyword">in</span> 3 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># check</span></span><br><span class="line">$./redis-trib.rb check 127.0.0.1:5000</span><br><span class="line">>>> Performing Cluster Check (using node 127.0.0.1:5000)</span><br><span class="line">M: 8b4b5f3aa0357331c644f2cf678a3b5eb7b42aa6 127.0.0.1:5000</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">M: 9865af8cda8dca53a8e5776900961540566af4aa 127.0.0.1:5001</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">M: 21ca40a9a2c8e178943d0b5311dbc4308ddd8438 127.0.0.1:5002</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">>>> Check <span class="hljs-keyword">for</span> open slots...</span><br><span class="line">>>> Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># call ex1</span></span><br><span class="line">$./redis-trib.rb call 127.0.0.1:5000 dbsize</span><br><span class="line">>>> Calling DBSIZE</span><br><span class="line">127.0.0.1:5000: 2</span><br><span class="line">127.0.0.1:5001: 0</span><br><span class="line">127.0.0.1:5002: 4</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># call ex2</span></span><br><span class="line">$./redis-trib.rb call 127.0.0.1:5000 keys <span class="hljs-string">'*'</span></span><br><span class="line">>>> Calling KEYS *</span><br><span class="line">127.0.0.1:5000: [<span class="hljs-string">"pushResult:preferredAt:2018-10-16T16:54:38.601"</span>, <span class="hljs-string">"pushResult:campaignId:223456"</span>]</span><br><span class="line">127.0.0.1:5001: []</span><br><span class="line">127.0.0.1:5002: [<span class="hljs-string">"pushResult:mobileSeq:123456"</span>, <span class="hljs-string">"pushResult:-1799219234927987399:idx"</span>, <span class="hljs-string">"pushResult:-1799219234927987399"</span>, <span class="hljs-string">"pushResult"</span>]</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 35개의 pushResult에 대해서 176개의 key 가 생성 되었고, 소요시간은 10초...</span></span><br><span class="line">$ ./redis-trib.rb info endpoint.clustercfg.apn2.cache.amazonaws.com:6379</span><br><span class="line">10.213.145.56:6379 (38a8538d...) -> 65 keys | 5461 slots | 2 slaves.</span><br><span class="line">10.213.145.43:6379 (84128d7b...) -> 62 keys | 5461 slots | 2 slaves.</span><br><span class="line">10.213.145.50:6379 (6fdadcab...) -> 49 keys | 5462 slots | 2 slaves.</span><br><span class="line">[OK] 176 keys <span class="hljs-keyword">in</span> 3 masters.</span><br><span class="line">0.01 keys per slot on average.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># (dev) 1224 개의 데이터를 bucket key/value 형태로 저장한결과 102/sec</span></span><br></pre></td></tr></tbody></table></figure>



<h1 id="참고서적"><a href="#참고서적" class="headerlink" title="참고서적"></a>참고서적</h1><table>
<thead>
<tr>
<th>Memcached 와 Redis</th>
<th>Redis 운영관리</th>
<th>Redis 핵심정리</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://user-images.githubusercontent.com/10233723/48313335-30530080-e5fe-11e8-8d0b-d95d15afca17.jpeg" alt="b1"></td>
<td><img src="https://user-images.githubusercontent.com/10233723/48313350-71e3ab80-e5fe-11e8-86a5-139b34d51b0c.jpeg" alt="b2"></td>
<td><img src="https://user-images.githubusercontent.com/10233723/48313358-89229900-e5fe-11e8-9f66-7feefb995631.jpeg" alt="b3"></td>
</tr>
</tbody></table>
<h1 id="참고사이트"><a href="#참고사이트" class="headerlink" title="참고사이트"></a>참고사이트</h1><ul>
<li>출처 : <a href="https://redis.io/clients#java" target="_blank" rel="external nofollow noopener noreferrer">https://redis.io/clients#java</a></li>
<li>출처 : <a href="http://bcho.tistory.com/654" target="_blank" rel="external nofollow noopener noreferrer">http://bcho.tistory.com/654</a></li>
<li>출처 : <a href="http://bcho.tistory.com/tag/%EA%B0%95%EB%8C%80%EB%AA%85" target="_blank" rel="external nofollow noopener noreferrer">http://bcho.tistory.com/tag/%EA%B0%95%EB%8C%80%EB%AA%85</a> </li>
<li>출처 : <a href="https://redis.io/" target="_blank" rel="external nofollow noopener noreferrer">https://redis.io/</a></li>
<li>출처 : <a href="https://aws.amazon.com/ko/elasticache/redis/" target="_blank" rel="external nofollow noopener noreferrer">https://aws.amazon.com/ko/elasticache/redis/</a></li>
</ul>
</body></html>
        </div>
        
        
        
    </div>
</div>








</div>-->
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">Categories</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">redis</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2018/11/12/about-redis/" class="image is-7by1">
            <img class="thumbnail" src="/images/redis.png" alt="About Redis">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-11-12T02:50:00.000Z">2018-11-12</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/redis/">redis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    22 minutes read (About 3253 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/11/12/about-redis/">About Redis</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="REDIS-개요"><a href="#REDIS-개요" class="headerlink" title="REDIS 개요"></a>REDIS 개요</h2><h3 id="REDIS란"><a href="#REDIS란" class="headerlink" title="REDIS란?"></a>REDIS란?</h3><p>REmote DIctionary Server, 디스크 기반이 아닌 인메모리 기반 데이터 저장소이다. 메모리를 사용하기 때문에 매우 빠른 장점이 있으며, 고가용성 및 샤딩을 통한 파티셔닝을 지원한다. 하지만 단점으로는 메모리 크기에 한정적이다. 아직까지는 동일 용량의 디스크 대비 메모리 가격이 비싸다. 그래서 사용하는 메모리 용량에 따라 경제적 부담을 져야하는 기회비용에 직면하게 된다. 또한 레디스는 키벨류 베이스의 디비로써, 복잡한 연산의 데이터베이스 방식에는 적절하지 않으나?! 아래 소개하는 spring data redis 로 구현은?! 할수 있다. 하지만, 여기에도 장단이 존재한다.. 관련해서 아래에서 알아보자. </p>
<p>리스트 데이터 입력 삭제가 MYSQL 대비 10배 빠르다고함! MAX <strong>100,000 QPS</strong></p>
<p>Redis서버는 1개의 싱글 쓰레드로 수행, 따라서 하나의 서버에 여러개의 서버 띄우는게 가능, 또한 이러한 특성으로 다양한 이슈가 만들어 질수 있음</p>
<h3 id="REDIS-vs-MEMCACHED"><a href="#REDIS-vs-MEMCACHED" class="headerlink" title="REDIS vs MEMCACHED"></a>REDIS vs MEMCACHED</h3><ul>
<li><p>둘다 속도는 100000QPS 로 비슷</p>
</li>
<li><p>둘다 샤딩을 통한 클러스터링 모드 지원</p>
</li>
<li><p>자료구조는 레디스가 많이 지원, 멤케시는 key-value만 지원</p>
</li>
<li><p>안정성의경우, 멤케시는 장애가 거의 없으나, 레디스의 경우 특성을 잘못 이해할경우 프로세스 장애 발생. flush_all 같은경우</p>
</li>
<li><p>응답속도의 균일성의 경우, 멤케시는 전체적으로 균일하나, 레디스는 멤케시에 비해 균일성이 떨어 질수 있음, 롱쿼리..</p>
</li>
<li><p>장애대응 혹은 영속성의경우, 레디스는 RDB(Snapshot)와 AOF(Journal)지원, 하지만 맴케시는 프로세스 재시작시 데이터 모두 날라감. 멤캐시 철학은 약간 “캐시는 정말 캐시 용도로만 써야되고, 데이터 초기화시 다시 원천소스를 조회하여 캐싱해야한다.” 와 같음</p>
</li>
<li><p>멤케시의 경우 ‘라이브러리로’ master/master 리플리케이션만 지원, 하지만 레디스는 ‘자체기능’으로 (master/slave)리플리케이션만 지원</p>
</li>
</ul>
<h3 id="REDIS-DATA-TYPE"><a href="#REDIS-DATA-TYPE" class="headerlink" title="REDIS DATA TYPE"></a>REDIS DATA TYPE</h3><p>아래에서 설명하는 데이터타입의경우, 실제 key-value 에서 value에 저장되는 데이터 타입을 말한다. 이것을 반드시 인지하고있어야한다.</p>
<ul>
<li>String<ul>
<li>동작 및 특징<ul>
<li>가장 기본이 되는 타입</li>
</ul>
</li>
<li>용도<ul>
<li>HTML 페이지, API 응답 이미지, 비디오, 텍스트, 바이너리 데이터 등 캐시</li>
<li>개수 계산이 필요한 페이지뷰, 비디오뷰 좋아요 같은 서비스</li>
</ul>
</li>
</ul>
</li>
<li>Hash<ul>
<li>동작 및 특징<ul>
<li>키값에 해당되는 필드를 선택적으로 가져올수 잇다. </li>
<li>객체를 저장하는데 훌륭</li>
</ul>
</li>
<li>용도<ul>
<li>특정 Key 값에 여러 field(hashKey)가 존재하여, 다양한 케이스에서 선택적으로 value를 가져와야하는경우</li>
</ul>
</li>
</ul>
</li>
<li>List<ul>
<li>동작 및 특징<ul>
<li>collection, stack, queue와 같이 동작 할수 있음</li>
</ul>
</li>
<li>용도<ul>
<li>이벤트큐, 최근 사용자 글 저장하기등</li>
</ul>
</li>
</ul>
</li>
<li>Set <ul>
<li>동작 및 특징<ul>
<li>순서없고, 동일한 값이 없는 콜렉션 특성을 가지고 있다. (추가,삭제,검색 성능 속도 O(1))</li>
<li>내부는 hash table 로 구현되있다.</li>
<li>교집합, 합집합 빠르게 계산</li>
</ul>
</li>
<li>용도<ul>
<li>데이터 필터링 : 특정도시에서 출발해서 특정도시로 도착하는 모든 비행기 필터링?</li>
<li>데이터 그룹핑 : 비슷한 제품을 보는 모든 사용자 그룹핑</li>
<li>엘리먼트십 확인 : 블랙리스트확인 혹은 사용자가 이미 푸시를 받앗는지 확인하기(dup check)</li>
</ul>
</li>
</ul>
</li>
<li>Sorted Set<ul>
<li>동작 및 특징</li>
<li>용도</li>
</ul>
</li>
<li><strong>BitMap</strong><ul>
<li>동작 및 특징<ul>
<li>특정 인덱스에 값을 0 또는 1로 set 및 get이 가능하다.</li>
<li>단일 저장 용량이 1Bit 라서, 메모리를 아주 적게 사용하여 스냅샷 서비스를 제공할수 있다.</li>
</ul>
</li>
<li>용도<ul>
<li>오늘 방문한 순수 사용자, 혹은 카운트</li>
<li>특정 모바일 아이디에 중복 발송을 필터링하기위한 테이블</li>
</ul>
</li>
</ul>
</li>
<li>HyperLogLog<ul>
<li>동작 및 특징</li>
<li>용도</li>
</ul>
</li>
</ul>
<h3 id="REDIS-PERSISTENCE"><a href="#REDIS-PERSISTENCE" class="headerlink" title="REDIS PERSISTENCE"></a>REDIS PERSISTENCE</h3><ul>
<li><p>시스템의 영속성을 보장하기위해 레디스에선 데이터를 디스크에 백업해 놓는 2가지 방식을 제공하고 있다.</p>
<ul>
<li><strong>Snapshotting</strong> : 레디스에 저장된 데이터를 바이너리 스냅샷으로 생성(메모리 덤프) > RDB 모드<ul>
<li>fork 로 자식 프로세스 생성하여 저장하는 방식<ul>
<li><strong>쓰기 작업이 많아지면 부모와 자식 둘다 같은 크기의 메모리를 사용할수 있음. 메모리 부족 이슈 가능</strong></li>
</ul>
</li>
<li>설정파일에 save 900 1 , save 300 60, save 60 10000 과 같이 설정</li>
</ul>
</li>
<li><strong>Journaling</strong> : 시간이 지나면서 요청된 커맨드를 사람이 읽을수 있는 파일로 생성 > AOF 모드</li>
</ul>
</li>
<li><p>만약 재기동 시점에 둘다 있으면, AOF 가 가장 마지막까지 실행됫다고 가정하고, AOF 모드로 재실행</p>
</li>
<li><p>하지만 이러한 persistence 기능이 장애의 주된 원인이 될수있어서, 아주 잘 사용해야 한다.</p>
</li>
</ul>
<h3 id="KEY-EXPIREATION-TRANSACTION-PUB-SUB"><a href="#KEY-EXPIREATION-TRANSACTION-PUB-SUB" class="headerlink" title="KEY EXPIREATION, TRANSACTION, PUB/SUB"></a>KEY EXPIREATION, TRANSACTION, PUB/SUB</h3><h4 id="KEY-EXPIREATION"><a href="#KEY-EXPIREATION" class="headerlink" title="KEY EXPIREATION"></a>KEY EXPIREATION</h4><p>key 값에 expireTime 지정이 가능하며, 해당 만료 시간을 기준으로 데이터가 삭제된다. 2가지 방식이 있으며, 초단위로 설정하거나 종료시점 날짜를 설정하여 만료시킬수 있음</p>
<p>맴케시의경우, 사용자가 get할때 expire체크를 하여 만료작업을 처리하지만, 레디스는 이 방법과 더불어 내부적으로 cron()을 돌려 추가적으로 만료작업을 진행한다.</p>
<h4 id="TRANSACTION"><a href="#TRANSACTION" class="headerlink" title="TRANSACTION"></a>TRANSACTION</h4><h4 id="PUB-SUB"><a href="#PUB-SUB" class="headerlink" title="PUB/SUB"></a>PUB/SUB</h4><h3 id="REDIS-CLUSTER"><a href="#REDIS-CLUSTER" class="headerlink" title="REDIS CLUSTER"></a>REDIS CLUSTER</h3><p>레디스 시스템 성능 확장을 위해 클러스터 모드로 레디스를 실행할수 있다. </p>
<p>노드간에 처리 대상은 수평분할(샤딩)의 한 방식인 해시분할(Hash partitioning)에 의해서 결정된다</p>
<p>해시분할방식은, 해시함수에 키값을 넣어 정수값(0~16383)을 추출, 각 마스터 노드 해시슬롯 범위에 포함된 곳에서 처리되도록 한다.</p>
<p>이러한 Hash key slot을 사용하여 샤딩방식으로 트래픽을 클러스터 노드별로 분산한다.</p>
<h3 id="REDIS-REPLICATION"><a href="#REDIS-REPLICATION" class="headerlink" title="REDIS REPLICATION"></a>REDIS REPLICATION</h3><ul>
<li>혹시모를 장애로 마스터 서버 이슈로, 데이터 유실 혹은 read 트래픽 분산을 위해 레디스 또한 데이터 리플리케이션 기능을 제공한다.</li>
<li>master / slave 복제 방식이다</li>
</ul>
<h3 id="REDIS-HA-High-Avaliability"><a href="#REDIS-HA-High-Avaliability" class="headerlink" title="REDIS HA(High Avaliability)"></a>REDIS HA(High Avaliability)</h3><ul>
<li>기본적으론 레디스 센티널 HA 컨트롤 되긴함.</li>
<li>m/s 복제 되어잇어야함</li>
<li>redis2.6부터 slave-read-only가 yes로 되어 있어, 무조건 마스터승격 시에 쓰기 요청 모두 실패됨. 추가설정필요..</li>
<li>하지만, 아주 다행히 AWS Elastic cache:Redis 사용시 replication, multi-az 2개 설정만으로 자동 장애복구 지원됨.<ul>
<li>replica 만 선택하고, multi-az 설정안하면, 사용자가 직접 마스터 승격시켜줘야하니.. multi-az 설정까지 해주자.ㅎㅎ</li>
<li>참고 : <a href="https://aws.amazon.com/ko/elasticache/faqs#다중_AZ" target="_blank" rel="external nofollow noopener noreferrer">https://aws.amazon.com/ko/elasticache/faqs#다중_AZ</a></li>
</ul>
</li>
</ul>
<h2 id="REDIS-적용"><a href="#REDIS-적용" class="headerlink" title="REDIS 적용"></a>REDIS 적용</h2><h3 id="‘’터미널’’에서-REDIS-클러스터-로컬환경-구축-및-사용"><a href="#‘’터미널’’에서-REDIS-클러스터-로컬환경-구축-및-사용" class="headerlink" title="‘’터미널’’에서 REDIS (클러스터) 로컬환경 구축 및 사용"></a>‘’터미널’’에서 REDIS (클러스터) 로컬환경 구축 및 사용</h3><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># redis가 로컬에 설치 되엇다는 가정하에 아래 실습을 진행할수 있다. </span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 6379 포트로 redis를 띄운다.</span></span><br><span class="line">$ redis-server</span><br><span class="line">127.0.0.1:6379> {{redis <span class="hljs-built_in">command</span>}}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis-cli는 레디스에 커맨드를 실행할수 있게 해준다. </span></span><br><span class="line"><span class="hljs-comment"># 아래는 해당 노드에 저장된 값의 size를 알수있는 command</span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">### 실제 로컬에서 띄울때 클러스터 모드로 띄워도 될듯!! 아래는 그 방법###</span></span><br><span class="line"></span><br><span class="line">$ redis-server --port 5000 --cluster-enabled yes --cluster-config-file nodes-5000.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5000.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-server --port 5001 --cluster-enabled yes --cluster-config-file nodes-5001.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5001.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-server --port 5002 --cluster-enabled yes --cluster-config-file nodes-5002.conf --cluster-node-timeout 2000 --cluster-slave-validity-factor 10 --cluster-migration-barrier 1 --cluster-require-full-coverage yes --dbfilename dump-5002.rdb --daemonize yes</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster addslots {0..5460}</span><br><span class="line">$ redis-cli -c -p 5001 cluster addslots {5461..10922}</span><br><span class="line">$ redis-cli -c -p 5002 cluster addslots {10923..16383}</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster <span class="hljs-built_in">set</span>-config-epoch 1</span><br><span class="line">$ redis-cli -c -p 5001 cluster <span class="hljs-built_in">set</span>-config-epoch 2</span><br><span class="line">$ redis-cli -c -p 5002 cluster <span class="hljs-built_in">set</span>-config-epoch 3</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 5000 cluster meet 127.0.0.1 5001</span><br><span class="line">$ redis-cli -c -p 5000 cluster meet 127.0.0.1 5002</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 6000 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6001 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6002 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6003 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6004 cluster meet 127.0.0.1 5000</span><br><span class="line">$ redis-cli -c -p 6005 cluster meet 127.0.0.1 5000</span><br><span class="line"></span><br><span class="line">$ redis-cli -c -p 6000 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6001 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6002 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6003 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6004 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line">$ redis-cli -c -p 6005 cluster replicate {{masterNodeIdForReplica}}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 클러스터 모드에서 사용</span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000 -c</span><br><span class="line">127.0.0.1:5000> <span class="hljs-built_in">set</span> hello world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:5000> get hello</span><br><span class="line"><span class="hljs-string">"world"</span></span><br><span class="line">127.0.0.1:5000> <span class="hljs-built_in">set</span> hello2 world2</span><br><span class="line">-> Redirected to slot [7486] located at 127.0.0.1:5001</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:5001> get hello2</span><br><span class="line"><span class="hljs-string">"world2"</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="REDIS-Client-Library-각-라이브러리-장단점"><a href="#REDIS-Client-Library-각-라이브러리-장단점" class="headerlink" title="REDIS Client Library(각 라이브러리 장단점)"></a>REDIS Client Library(각 라이브러리 장단점)</h3><p>java base의 redis client libracy 중에 recommed 하는 라이브러리는 크게 3가지 Jedis, Lettuce, Redisson가 있다.</p>
<h4 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h4><ul>
<li>small</li>
</ul>
<h4 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h4><ul>
<li>thread-safe sync</li>
<li>async</li>
</ul>
<h4 id="REDISON"><a href="#REDISON" class="headerlink" title="REDISON"></a>REDISON</h4><ul>
<li>비동기 하이퍼포먼스</li>
<li>lock free redis client</li>
</ul>
<h3 id="AWS-REDIS-소개"><a href="#AWS-REDIS-소개" class="headerlink" title="AWS REDIS 소개"></a>AWS REDIS 소개</h3><p>AWS 의 서비스중에 <strong>ElasticCache</strong> 라는 것이 있는데, 해당 서비스는 인메모리 서비스 그룹으로, 실제로 해당 서비스 실행을 위해 Redis를 쓸지 Memchaed를 쓸지 선택할수 있다. AWS의 인프라 제공 능력?!으로 클릭 몇번으로 클러스터기반 마스터슬래이브 레디스 서비스를 실행할수 있다. (자동 장애복구 기능도 지원한당. 짜응)</p>
<h2 id="기타-알면-좋은것들"><a href="#기타-알면-좋은것들" class="headerlink" title="기타 알면 좋은것들"></a>기타 알면 좋은것들</h2><h3 id="SPRINT-DATA-REDIS-Spring-data-redis-lettuce"><a href="#SPRINT-DATA-REDIS-Spring-data-redis-lettuce" class="headerlink" title="SPRINT DATA REDIS (Spring data redis + lettuce)"></a>SPRINT DATA REDIS (Spring data redis + lettuce)</h3><h4 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h4><figure class="highlight java hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// entity class</span></span><br><span class="line"><span class="hljs-meta">@Getter</span></span><br><span class="line"><span class="hljs-meta">@Builder</span></span><br><span class="line"><span class="hljs-meta">@AllArgsConstructor</span>(access = AccessLevel.PRIVATE)</span><br><span class="line"><span class="hljs-meta">@NoArgsConstructor</span></span><br><span class="line"><span class="hljs-meta">@ToString</span></span><br><span class="line"><span class="hljs-meta">@RedisHash</span>(<span class="hljs-string">"pushResult"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PushResult</span> </span>{</span><br><span class="line">	<span class="hljs-meta">@Id</span></span><br><span class="line">	<span class="hljs-keyword">private</span> Long id;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> mobileSeq;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> campaignId;</span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> offerId;</span><br><span class="line">	<span class="hljs-meta">@Indexed</span></span><br><span class="line">	<span class="hljs-keyword">private</span> LocalDateTime preferredAt;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// *RedisRepository interface</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PushResultRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span><<span class="hljs-title">PushResult</span>, <span class="hljs-title">Long</span>> </span>{</span><br><span class="line">	<span class="hljs-function">PushResult <span class="hljs-title">findByMobileSeqAndCampaignId</span><span class="hljs-params">(Long mobileSeq, Long cId)</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// service class</span></span><br><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> PushResultService {</span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    <span class="hljs-keyword">private</span> PushResultRepository pushResultRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(PushResult pushResult)</span> </span>{</span><br><span class="line">        pushResultRepository.save(pushResult);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> PushResult <span class="hljs-title">getByMobileSeqAndCId</span><span class="hljs-params">(Long mobileSeq, Long cId)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">return</span> pushResultRepository.findByMobileSeqAndCampaignId(mobileSeq, cId);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="동작"><a href="#동작" class="headerlink" title="동작"></a>동작</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">###############################################################</span></span><br><span class="line"><span class="hljs-comment"># 위 spring data jpa 를 사용하여 1건의 pushResult 를 save 할경우 #</span></span><br><span class="line"><span class="hljs-comment">###############################################################</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis cluster nodes 에 저장된 key 개수 </span></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5000 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5001 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 5002 dbsize</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># redis cluster nodes 에 저장된 key 종류</span></span><br><span class="line">$ 127.0.0.1:5000> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:campaignId:223456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:-7496779863478802681:idx"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5001> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:preferredAt:2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$127</span>.0.0.1:5002> keys *</span><br><span class="line">1) <span class="hljs-string">"pushResult:mobileSeq:123456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:-7496779863478802681"</span></span><br><span class="line">3) <span class="hljs-string">"pushResult"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 각 key 에 대한 value</span></span><br><span class="line">$ 127.0.0.1:5000> smembers pushResult:campaignId:223456</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5000> smembers pushResult:-7496779863478802681:idx</span><br><span class="line">1) <span class="hljs-string">"pushResult:mobileSeq:123456"</span></span><br><span class="line">2) <span class="hljs-string">"pushResult:campaignId:223456"</span></span><br><span class="line">3) <span class="hljs-string">"pushResult:preferredAt:2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5001> smembers pushResult:preferredAt:2018-10-16T15:49:12.949</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line"></span><br><span class="line">$ 127.0.0.1:5002> smembers pushResult:mobileSeq:123456</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5002> smembers pushResult</span><br><span class="line">1) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">$ 127.0.0.1:5002> hkeys pushResult:-7496779863478802681</span><br><span class="line">1) <span class="hljs-string">"_class"</span></span><br><span class="line">2) <span class="hljs-string">"mobileSeq"</span></span><br><span class="line">3) <span class="hljs-string">"id"</span></span><br><span class="line">4) <span class="hljs-string">"mobileSeq._class"</span></span><br><span class="line">5) <span class="hljs-string">"offerId"</span></span><br><span class="line">6) <span class="hljs-string">"offerId._class"</span></span><br><span class="line">7) <span class="hljs-string">"campaignId"</span></span><br><span class="line">8) <span class="hljs-string">"campaignId._class"</span></span><br><span class="line">9) <span class="hljs-string">"preferredAt"</span></span><br><span class="line">$ 127.0.0.1:5002> hgetall pushResult:-7496779863478802681</span><br><span class="line"> 1) <span class="hljs-string">"mobileSeq._class"</span></span><br><span class="line"> 2) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line"> 3) <span class="hljs-string">"offerId"</span></span><br><span class="line"> 4) <span class="hljs-string">"123456"</span></span><br><span class="line"> 5) <span class="hljs-string">"offerId._class"</span></span><br><span class="line"> 6) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line"> 7) <span class="hljs-string">"campaignId"</span></span><br><span class="line"> 8) <span class="hljs-string">"223456"</span></span><br><span class="line"> 9) <span class="hljs-string">"campaignId._class"</span></span><br><span class="line">10) <span class="hljs-string">"java.lang.Long"</span></span><br><span class="line">11) <span class="hljs-string">"mobileSeq"</span></span><br><span class="line">12) <span class="hljs-string">"123456"</span></span><br><span class="line">13) <span class="hljs-string">"_class"</span></span><br><span class="line">14) <span class="hljs-string">"com.~.pushcontroller.domain.result.PushResult"</span></span><br><span class="line">15) <span class="hljs-string">"id"</span></span><br><span class="line">16) <span class="hljs-string">"-7496779863478802681"</span></span><br><span class="line">17) <span class="hljs-string">"preferredAt"</span></span><br><span class="line">18) <span class="hljs-string">"2018-10-16T15:49:12.949"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">############################## 위 명령어가 다른이유 ##############################</span></span><br><span class="line"><span class="hljs-comment"># if value is of type string -> GET <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type hash -> HGETALL <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type lists -> lrange <key> <start> <end></end></start></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type sets -> smembers <key></key></span></span><br><span class="line"><span class="hljs-comment"># if value is of type sorted sets -> ZRANGEBYSCORE <key> <min> <max></max></min></key></span></span><br><span class="line"><span class="hljs-comment">#############################################################################</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="REDIS-비교-결과"><a href="#REDIS-비교-결과" class="headerlink" title="REDIS 비교 결과"></a>REDIS 비교 결과</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">##############################</span></span><br><span class="line"><span class="hljs-comment"># [Local 환경]퍼포먼스 테스트 결과 #</span></span><br><span class="line"><span class="hljs-comment">##############################</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># master 3, slave6, network high</span></span><br><span class="line"><span class="hljs-comment"># Redisson (pure redis client): 10000/sec</span></span><br><span class="line"><span class="hljs-comment"># spring data redis : 33.3/sec</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h3><h4 id="CLUSTER-INFO"><a href="#CLUSTER-INFO" class="headerlink" title="CLUSTER INFO"></a>CLUSTER INFO</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># cluster meet 전</span></span><br><span class="line">cluster_state:fail</span><br><span class="line">cluster_slots_assigned:0</span><br><span class="line">cluster_slots_ok:0</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:1</span><br><span class="line">cluster_size:0</span><br><span class="line">cluster_current_epoch:0</span><br><span class="line">cluster_my_epoch:0</span><br><span class="line">cluster_stats_messages_sent:0</span><br><span class="line">cluster_stats_messages_received:0</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># cluster meet 후</span></span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:3</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:3</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:553</span><br><span class="line">cluster_stats_messages_pong_sent:553</span><br><span class="line">cluster_stats_messages_meet_sent:2</span><br><span class="line">cluster_stats_messages_sent:1108</span><br><span class="line">cluster_stats_messages_ping_received:553</span><br><span class="line">cluster_stats_messages_pong_received:555</span><br><span class="line">cluster_stats_messages_received:1108</span><br></pre></td></tr></tbody></table></figure>



<h4 id="CLUSTER-KEYSLOT"><a href="#CLUSTER-KEYSLOT" class="headerlink" title="CLUSTER KEYSLOT "></a>CLUSTER KEYSLOT </h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ 127.0.0.1:5000> cluster keyslot pushResult:campaignId:225763</span><br><span class="line">(<span class="hljs-built_in">integer</span>) 11216</span><br></pre></td></tr></tbody></table></figure>



<h4 id="CLIENT-LIST"><a href="#CLIENT-LIST" class="headerlink" title="CLIENT LIST"></a>CLIENT LIST</h4><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ 127.0.0.1:5000> client list</span><br><span class="line">id=320 addr=127.0.0.1:49228 fd=320 name= age=1890 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=client</span><br><span class="line">id=16 addr=127.0.0.1:63855 fd=16 name= age=2452 idle=2416 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=cluster</span><br></pre></td></tr></tbody></table></figure>



<h3 id="redis-trib-rb-사용하기"><a href="#redis-trib-rb-사용하기" class="headerlink" title="# redis-trib.rb 사용하기"></a># redis-trib.rb 사용하기</h3><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># redis cluster info</span></span><br><span class="line"><<<<<<< HEAD:_drafts/about-redis.md</span><br><span class="line"><span class="hljs-comment"># /Development/study/redis/redis-stable/src/redis-trib.rb </span></span><br><span class="line">=======</span><br><span class="line">>>>>>>> 8199a64e366805ddde1586b4cf8444993e165799:_posts/2018-11-11-about-redis.md</span><br><span class="line">$./redis-trib.rb info 127.0.0.1:5000</span><br><span class="line">127.0.0.1:5000 (8b4b5f3a...) -> 2 keys | 5461 slots | 0 slaves.</span><br><span class="line">127.0.0.1:5001 (9865af8c...) -> 0 keys | 5462 slots | 0 slaves.</span><br><span class="line">127.0.0.1:5002 (21ca40a9...) -> 4 keys | 5461 slots | 0 slaves.</span><br><span class="line">[OK] 6 keys <span class="hljs-keyword">in</span> 3 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># check</span></span><br><span class="line">$./redis-trib.rb check 127.0.0.1:5000</span><br><span class="line">>>> Performing Cluster Check (using node 127.0.0.1:5000)</span><br><span class="line">M: 8b4b5f3aa0357331c644f2cf678a3b5eb7b42aa6 127.0.0.1:5000</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">M: 9865af8cda8dca53a8e5776900961540566af4aa 127.0.0.1:5001</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">M: 21ca40a9a2c8e178943d0b5311dbc4308ddd8438 127.0.0.1:5002</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   0 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">>>> Check <span class="hljs-keyword">for</span> open slots...</span><br><span class="line">>>> Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># call ex1</span></span><br><span class="line">$./redis-trib.rb call 127.0.0.1:5000 dbsize</span><br><span class="line">>>> Calling DBSIZE</span><br><span class="line">127.0.0.1:5000: 2</span><br><span class="line">127.0.0.1:5001: 0</span><br><span class="line">127.0.0.1:5002: 4</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># call ex2</span></span><br><span class="line">$./redis-trib.rb call 127.0.0.1:5000 keys <span class="hljs-string">'*'</span></span><br><span class="line">>>> Calling KEYS *</span><br><span class="line">127.0.0.1:5000: [<span class="hljs-string">"pushResult:preferredAt:2018-10-16T16:54:38.601"</span>, <span class="hljs-string">"pushResult:campaignId:223456"</span>]</span><br><span class="line">127.0.0.1:5001: []</span><br><span class="line">127.0.0.1:5002: [<span class="hljs-string">"pushResult:mobileSeq:123456"</span>, <span class="hljs-string">"pushResult:-1799219234927987399:idx"</span>, <span class="hljs-string">"pushResult:-1799219234927987399"</span>, <span class="hljs-string">"pushResult"</span>]</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 35개의 pushResult에 대해서 176개의 key 가 생성 되었고, 소요시간은 10초...</span></span><br><span class="line">$ ./redis-trib.rb info endpoint.clustercfg.apn2.cache.amazonaws.com:6379</span><br><span class="line">10.213.145.56:6379 (38a8538d...) -> 65 keys | 5461 slots | 2 slaves.</span><br><span class="line">10.213.145.43:6379 (84128d7b...) -> 62 keys | 5461 slots | 2 slaves.</span><br><span class="line">10.213.145.50:6379 (6fdadcab...) -> 49 keys | 5462 slots | 2 slaves.</span><br><span class="line">[OK] 176 keys <span class="hljs-keyword">in</span> 3 masters.</span><br><span class="line">0.01 keys per slot on average.</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># (dev) 1224 개의 데이터를 bucket key/value 형태로 저장한결과 102/sec</span></span><br></pre></td></tr></tbody></table></figure>



<h1 id="참고서적"><a href="#참고서적" class="headerlink" title="참고서적"></a>참고서적</h1><table>
<thead>
<tr>
<th>Memcached 와 Redis</th>
<th>Redis 운영관리</th>
<th>Redis 핵심정리</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://user-images.githubusercontent.com/10233723/48313335-30530080-e5fe-11e8-8d0b-d95d15afca17.jpeg" alt="b1"></td>
<td><img src="https://user-images.githubusercontent.com/10233723/48313350-71e3ab80-e5fe-11e8-86a5-139b34d51b0c.jpeg" alt="b2"></td>
<td><img src="https://user-images.githubusercontent.com/10233723/48313358-89229900-e5fe-11e8-9f66-7feefb995631.jpeg" alt="b3"></td>
</tr>
</tbody></table>
<h1 id="참고사이트"><a href="#참고사이트" class="headerlink" title="참고사이트"></a>참고사이트</h1><ul>
<li>출처 : <a href="https://redis.io/clients#java" target="_blank" rel="external nofollow noopener noreferrer">https://redis.io/clients#java</a></li>
<li>출처 : <a href="http://bcho.tistory.com/654" target="_blank" rel="external nofollow noopener noreferrer">http://bcho.tistory.com/654</a></li>
<li>출처 : <a href="http://bcho.tistory.com/tag/%EA%B0%95%EB%8C%80%EB%AA%85" target="_blank" rel="external nofollow noopener noreferrer">http://bcho.tistory.com/tag/%EA%B0%95%EB%8C%80%EB%AA%85</a> </li>
<li>출처 : <a href="https://redis.io/" target="_blank" rel="external nofollow noopener noreferrer">https://redis.io/</a></li>
<li>출처 : <a href="https://aws.amazon.com/ko/elasticache/redis/" target="_blank" rel="external nofollow noopener noreferrer">https://aws.amazon.com/ko/elasticache/redis/</a></li>
</ul>
</body></html>
        </div>
        
        
        
    </div>
</div>








</div>
                






    <div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
        
            
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="/images/avatar.png" alt="Crayon">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Crayon
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Back-end Engineer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Seoul, Korea</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            19
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            5
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            32
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ppoffice" target="_blank" rel="external nofollow noopener noreferrer">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/ppoffice" rel="external nofollow noopener noreferrer">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="https://facebook.com" rel="external nofollow noopener noreferrer">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="https://twitter.com" rel="external nofollow noopener noreferrer">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="https://dribbble.com" rel="external nofollow noopener noreferrer">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
        
            
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ML/">
            <span class="level-start">
                <span class="level-item">ML</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/architecture/">
            <span class="level-start">
                <span class="level-item">architecture</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/db/">
            <span class="level-start">
                <span class="level-item">db</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/redis/">
            <span class="level-start">
                <span class="level-item">redis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/spring/">
            <span class="level-start">
                <span class="level-item">spring</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2020/09/02/bookreview-object-01/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/wang_tta_na_mu.png" alt="BookReview 오브젝트 - 01.객체,설계">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-09-02T08:02:00.000Z">2020-09-02</time></div>
                    <a href="/2020/09/02/bookreview-object-01/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BookReview 오브젝트 - 01.객체,설계</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/08/30/bookreview-object-introduction/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Book review 오브젝트intro">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-08-29T21:47:00.000Z">2020-08-30</time></div>
                    <a href="/2020/08/30/bookreview-object-introduction/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Book review 오브젝트intro</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/16/aws-training/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/aws_logo.jpg" alt="AWS training">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-15T15:30:00.000Z">2019-12-16</time></div>
                    <a href="/2019/12/16/aws-training/" class="title has-link-black-ter is-size-6 has-text-weight-normal">AWS training</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/08/java8/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/java8.png" alt="Functional programming in java8">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-07T22:18:00.000Z">2019-12-08</time></div>
                    <a href="/2019/12/08/java8/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Functional programming in java8</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/11/28/oop/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="OOP : Object Oriented Programming">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-28T02:47:00.000Z">2019-11-28</time></div>
                    <a href="/2019/11/28/oop/" class="title has-link-black-ter is-size-6 has-text-weight-normal">OOP : Object Oriented Programming</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/architecture/">architecture</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="external nofollow noopener noreferrer">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank" rel="external nofollow noopener noreferrer">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/BookReview/" style="font-size: 20px;">BookReview</a> <a href="/tags/OOP/" style="font-size: 20px;">OOP</a> <a href="/tags/Object/" style="font-size: 20px;">Object</a> <a href="/tags/airflow/" style="font-size: 10px;">airflow</a> <a href="/tags/akka/" style="font-size: 10px;">akka</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/aws/" style="font-size: 20px;">aws</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/clustering/" style="font-size: 10px;">clustering</a> <a href="/tags/designpattern/" style="font-size: 10px;">designpattern</a> <a href="/tags/docker/" style="font-size: 20px;">docker</a> <a href="/tags/factory/" style="font-size: 10px;">factory</a> <a href="/tags/functionalprogramming/" style="font-size: 10px;">functionalprogramming</a> <a href="/tags/future/" style="font-size: 10px;">future</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/infra/" style="font-size: 10px;">infra</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/java8/" style="font-size: 20px;">java8</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/machinelearning/" style="font-size: 10px;">machinelearning</a> <a href="/tags/ml/" style="font-size: 10px;">ml</a> <a href="/tags/oop/" style="font-size: 10px;">oop</a> <a href="/tags/oracle/" style="font-size: 10px;">oracle</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/springframework/" style="font-size: 10px;">springframework</a> <a href="/tags/traning/" style="font-size: 10px;">traning</a> <a href="/tags/xray/" style="font-size: 10px;">xray</a> <a href="/tags/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5/" style="font-size: 10px;">객체지향</a>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">September 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/08/">
                <span class="level-start">
                    <span class="level-item">August 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/BookReview/">
                        <span class="tag">BookReview</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OOP/">
                        <span class="tag">OOP</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Object/">
                        <span class="tag">Object</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/airflow/">
                        <span class="tag">airflow</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/akka/">
                        <span class="tag">akka</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/apache/">
                        <span class="tag">apache</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aws/">
                        <span class="tag">aws</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bash/">
                        <span class="tag">bash</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/clustering/">
                        <span class="tag">clustering</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/designpattern/">
                        <span class="tag">designpattern</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/factory/">
                        <span class="tag">factory</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/functionalprogramming/">
                        <span class="tag">functionalprogramming</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/future/">
                        <span class="tag">future</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/gradle/">
                        <span class="tag">gradle</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/infra/">
                        <span class="tag">infra</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java8/">
                        <span class="tag">java8</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/k8s/">
                        <span class="tag">k8s</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kafka/">
                        <span class="tag">kafka</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kubernetes/">
                        <span class="tag">kubernetes</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/machinelearning/">
                        <span class="tag">machinelearning</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ml/">
                        <span class="tag">ml</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oop/">
                        <span class="tag">oop</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/oracle/">
                        <span class="tag">oracle</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/python/">
                        <span class="tag">python</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/shell/">
                        <span class="tag">shell</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/springframework/">
                        <span class="tag">springframework</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/traning/">
                        <span class="tag">traning</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/xray/">
                        <span class="tag">xray</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5/">
                        <span class="tag">객체지향</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        
            <div class="column-right-shadow is-hidden-widescreen is-sticky">
                
                    
                
            </div>
        
    </div>



                






    <div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
        
            
        
        
    </div>



            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Crayon&#39;s Blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Crayon&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/" rel="external nofollow noopener noreferrer">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/" rel="external nofollow noopener noreferrer">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus" rel="external nofollow noopener noreferrer">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: false,
            fold: ''
        }
    }
};
</script>




    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="external nofollow noopener noreferrer">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>